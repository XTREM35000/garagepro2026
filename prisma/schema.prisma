generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =================== ENUMS ===================
enum UserRole {
  super_admin
  tenant_admin
  viewer
  user
}



enum VehicleStatus {
  AVAILABLE
  BUSY
  MAINTENANCE
}

enum VehiclePhotoType {
  BEFORE
  AFTER
}

enum CashType {
  CASH
  CARD
  TRANSFER
}

enum InvoiceStatus {
  DRAFT
  PAID
  CANCELLED
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
}

// =================== MODELS ===================
model Tenant {
  id        String @id @default(uuid()) @db.Uuid
  name      String
  address   String
  logoUrl   String?
  rccm      String?
  plan      String
  stripeId  String?
  trialEnds DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  users          User[]
  cashRegisters  CashRegister[]
  expenses       Expense[]
  invoices       Invoice[]
  stockItems     StockItem[]
  subscriptions  Subscription[]
  vehicles       Vehicle[]
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  avatarUrl String?
  role      UserRole  @default(user)
  tenantId  String    @db.Uuid
  tenant    Tenant    @relation(fields: [tenantId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())

  cashRegisters CashRegister[] @relation("UserCashRegisters")
  expenses      Expense[]      @relation("UserExpenses")
  invoices      Invoice[]      @relation("UserInvoices")
  vehiclePhotos VehiclePhoto[] @relation("UserVehiclePhotos")
}

model CashRegister {
  id        String   @id @default(uuid()) @db.Uuid
  montant   Float
  type      CashType
  motif     String
  faitParId String   @db.Uuid
  faitPar   User     @relation("UserCashRegisters", fields: [faitParId], references: [id])
  tenantId  String   @db.Uuid
  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Expense {
  id        String   @id @default(uuid()) @db.Uuid
  libelle   String
  montant   Float
  categorie String
  faitParId String   @db.Uuid
  faitPar   User     @relation("UserExpenses", fields: [faitParId], references: [id])
  tenantId  String   @db.Uuid
  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Invoice {
  id          String       @id @default(uuid()) @db.Uuid
  numero      String       @unique
  total       Float
  statut      InvoiceStatus
  vehicleId   String       @db.Uuid
  vehicle     Vehicle      @relation(fields: [vehicleId], references: [id])
  clientNom   String
  clientTel   String
  createdById String       @db.Uuid
  createdBy   User         @relation("UserInvoices", fields: [createdById], references: [id])
  tenantId    String       @db.Uuid
  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @default(now())
}

model StockItem {
  id          String   @id @default(uuid()) @db.Uuid
  nom         String
  categorie   String
  quantite    Int
  prixAchat   Float
  prixVente   Float
  seuilAlerte Int
  tenantId    String   @db.Uuid
  tenant      Tenant   @relation(fields: [tenantId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model Subscription {
  id                   String             @id @default(uuid()) @db.Uuid
  plan                 String
  status               SubscriptionStatus
  stripeCustomerId     String
  stripeSubscriptionId String
  tenantId             String             @db.Uuid
  tenant               Tenant             @relation(fields: [tenantId], references: [id])
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @default(now())
}

model Vehicle {
  id         String        @id @default(uuid()) @db.Uuid
  marque     String
  modele     String
  immatricule String
  status     VehicleStatus
  tenantId   String        @db.Uuid
  tenant     Tenant        @relation(fields: [tenantId], references: [id])
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @default(now())

  invoices      Invoice[]
  vehiclePhotos VehiclePhoto[]
}

model VehiclePhoto {
  id         String           @id @default(uuid()) @db.Uuid
  type       VehiclePhotoType
  url        String
  takenById  String           @db.Uuid
  takenBy    User             @relation("UserVehiclePhotos", fields: [takenById], references: [id])
  vehicleId  String           @db.Uuid
  vehicle    Vehicle          @relation(fields: [vehicleId], references: [id])
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @default(now())
}
